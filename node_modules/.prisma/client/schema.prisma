datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum Role {
  ADMIN
  USER
}

enum AuctionStatus {
  DRAFT
  RUNNING
  ENDED
  CANCELED // Opsional: jika admin membatalkan lelang
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  name      String
  role      Role     @default(USER)
  createdAt DateTime @default(now())

  bids  Bid[]
  items Item[] // Item yang dibuat oleh admin ini
}

model Item {
  id          Int      @id @default(autoincrement())
  title       String
  description String?  @db.Text // Gunakan Text agar bisa menampung deskripsi panjang
  imageUrl    String?
  basePrice   Decimal  @db.Decimal(15, 2) // Perbaikan: Gunakan Decimal
  createdAt   DateTime @default(now())

  adminId Int
  admin   User @relation(fields: [adminId], references: [id])

  auction Auction?
}

model Auction {
  id     Int  @id @default(autoincrement())
  itemId Int  @unique
  item   Item @relation(fields: [itemId], references: [id])

  startTime DateTime
  endTime   DateTime
  status    AuctionStatus @default(DRAFT)

  // Field optimasi untuk performa read:
  currentPrice Decimal @default(0) @db.Decimal(15, 2)

  highestBidId Int? @unique // Pastikan 1 bid hanya jadi highest di 1 auction
  highestBid   Bid? @relation("HighestBid", fields: [highestBidId], references: [id])

  bids Bid[] @relation("AuctionBids")
}

model Bid {
  id        Int      @id @default(autoincrement())
  amount    Decimal  @db.Decimal(15, 2) // Perbaikan: Gunakan Decimal
  createdAt DateTime @default(now())

  auctionId Int
  userId    Int

  // Relasi ke Auction sebagai salah satu bid
  auction Auction @relation("AuctionBids", fields: [auctionId], references: [id])
  user    User    @relation(fields: [userId], references: [id])

  // Relasi balik jika bid ini menjadi highest bid
  wonAuction Auction? @relation("HighestBid")

  // Indexing agar query history bid per auction cepat
  @@index([auctionId])
}
